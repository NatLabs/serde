name: Makefile CI

on:
    push:
        branches: ["main"]
    pull_request:
        branches: ["main", "actions"]

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v3
            - uses: actions/aviate-labs/setup-dfx@v0.2.3
              with:
                vessel-version: 0.6.3
                dfx-version: 0.12.1
              
            - name: "install mops"
              run: |
                  npm -g i mops

            - name: Detect Warnings
              run: make no-warn

            - name: Run Tests
              run: make test

            - name: Generate Docs
              run: make docs
